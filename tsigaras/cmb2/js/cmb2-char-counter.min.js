"use strict";window.CMB2=window.CMB2||{},window.CMB2.charcounter=window.CMB2.charcounter||{},function(t,e,r,a,i){if(!wp.utils||!wp.utils.WordCounter)return a.log("Cannot find wp.utils!");i.counters={};var d=i.counters,u=new wp.utils.WordCounter;i.updateCounter=function(t){if(!d.hasOwnProperty(t))return null;var n=d[t],e=n.editor&&!n.editor.isHidden()?n.editor.getContent({format:"raw"}):a.$id(t).val().trim(),r=u.count(e,n.type),i=n.max&&r>n.max,o=n.max?n.max-r:r;return n.$el.parents(".cmb2-char-counter-wrap")[i?"addClass":"removeClass"]("cmb2-max-exceeded"),n.$el.val(o).outerWidth(8*String(o).length+15+"px"),r},i.instantiate=function(t){var n=t.data();if(!(n.fieldId in d)){var e={$el:t,max:n.max,type:"words"===n.counterType?"words":"characters_including_spaces",editor:!1};d[n.fieldId]=e,i.updateCounter(n.fieldId)}},i.initAll=function(){r(".cmb2-char-counter").each(function(){i.instantiate(r(this))})},i.initWysiwyg=function(t,n){n.id in d&&(d[n.id].editor=n).on("nodechange keyup",i.countWysiwyg)},i.addRow=function(t,n){n.find(".cmb2-char-counter").each(function(){var t=r(this),n=t.attr("id").replace(/^char-counter-/,"");t.attr("data-field-id",n).data("field-id",n),i.instantiate(t)})},i.cleanCounters=function(){var t,n=[];for(t in d)e.getElementById(t)||n.push(t);n.length&&_.each(n,function(t){delete d[t]})},i.countWysiwyg=_.throttle(function(t){return t.hasOwnProperty("element")?i.updateCounter(r(t.element).data("id")):t.hasOwnProperty("currentTarget")?i.updateCounter(r(t.currentTarget).data("id")):void 0}),i.countTextarea=_.throttle(function(t){i.updateCounter(t.currentTarget.id)},400),r(e).on("cmb_init",i.initAll).on("tinymce-editor-init",i.initWysiwyg).on("cmb2_add_row",i.addRow).on("cmb2_remove_row",i.cleanCounters).on("input keyup",".cmb2-count-chars",i.countTextarea)}(window,document,jQuery,window.CMB2,window.CMB2.charcounter);
