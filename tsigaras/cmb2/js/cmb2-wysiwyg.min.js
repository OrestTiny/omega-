"use strict";window.CMB2=window.CMB2||{},window.CMB2.wysiwyg=window.CMB2.wysiwyg||{},function(o,r,a,c,s){var f=[],l=[],u=s.all={};function w(){0===f.length?l.forEach(function(i){l.splice(l.indexOf(i),1),s.init.apply(s,i)}):o.setTimeout(w,100)}function e(){f.forEach(function(i){f.splice(f.indexOf(i),1),s.destroy(i)})}s.initAll=function(){var i,t,e;a(".cmb2-wysiwyg-placeholder").each(function(){i=a(this),(t=i.data()).groupid&&(t.id=i.attr("id"),t.name=i.attr("name"),t.value=i.val(),s.init(i,t,!1),e=!0)}),!0===e&&(void 0!==o.QTags&&o.QTags._buttonsInit(),a(r).on("cmb2_add_row",s.addRow).on("cmb2_remove_group_row_start",s.destroyRowEditors).on("cmb2_shift_rows_start",s.shiftStart).on("cmb2_shift_rows_complete",s.shiftComplete))},s.addRow=function(i,t){s.initRow(t,i)},s.destroyRowEditors=function(i,t){s.destroy(t.parents(".cmb-repeatable-grouping").find(".wp-editor-area").attr("id"))},s.shiftStart=function(i,t,e,n){e.add(n).find(".wp-editor-wrap textarea").each(function(){s.destroy(a(this).attr("id"))})},s.shiftComplete=function(i,t,e,n){e.add(n).each(function(){s.initRow(a(this),i)})},s.initRow=function(i,t){var e,n,d;i.find(".cmb2-wysiwyg-inner-wrap").each(function(){e=a(this),n=e.data(),d=void 0!==(d=c.getFieldArg(n.hash,"default",""))&&!1!==d?d:"",n.iterator=i.data("iterator"),n.fieldid=n.id,n.id=n.groupid+"_"+n.iterator+"_"+n.fieldid,n.name=n.groupid+"["+n.iterator+"]["+n.fieldid+"]",n.value="cmb2_add_row"!==t.type&&e.find(".wp-editor-area").length?e.find(".wp-editor-area").val():d,0===f.length?s.init(e,n):(l.push([e,n]),o.setTimeout(w,100))})},s.init=function(i,t,e){if(!t.groupid)return!1;var n=c.canTinyMCE(),d="function"==typeof o.quicktags;a.extend(t,function(i){var t=i.groupid,e=i.fieldid;return u[t]&&u[t][e]||(u[t]=u[t]||{},u[t][e]={template:wp.template("cmb2-wysiwyg-"+t+"-"+e),defaults:{mce:a.extend({},tinyMCEPreInit.mceInit["cmb2_i_"+t+e]),qt:a.extend({},tinyMCEPreInit.qtInit["cmb2_i_"+t+e])}},delete tinyMCEPreInit.mceInit["cmb2_i_"+t+e],delete tinyMCEPreInit.qtInit["cmb2_i_"+t+e]),u[t][e]}(t)),function(i){var t,e,n,d=new RegExp("cmb2_n_"+i.groupid+i.fieldid,"g"),o=new RegExp("cmb2_i_"+i.groupid+i.fieldid,"g");if(void 0===tinyMCEPreInit.mceInit[i.id]){for(t in e=a.extend({},i.defaults.mce))"string"==typeof e[t]&&(e[t]=e[t].replace(o,i.id).replace(d,i.name));tinyMCEPreInit.mceInit[i.id]=e}if(void 0===tinyMCEPreInit.qtInit[i.id]){for(t in n=a.extend({},i.defaults.qt))"string"==typeof n[t]&&(n[t]=n[t].replace(o,i.id).replace(d,i.name));tinyMCEPreInit.qtInit[i.id]=n}}(t),i.replaceWith(t.template(t)),n&&o.tinyMCE.init(tinyMCEPreInit.mceInit[t.id]),d&&o.quicktags(tinyMCEPreInit.qtInit[t.id]),n&&a(r.getElementById(t.id)).parents(".wp-editor-wrap").removeClass("html-active").addClass("tmce-active"),!1!==e&&void 0!==o.QTags&&o.QTags._buttonsInit()},s.destroy=function(i){if(c.canTinyMCE()){var t=tinyMCE.get(i);null!=t?(t.destroy(),void 0===tinyMCEPreInit.mceInit[i]&&delete tinyMCEPreInit.mceInit[i],void 0===tinyMCEPreInit.qtInit[i]&&delete tinyMCEPreInit.qtInit[i]):-1===f.indexOf(i)&&(f.push(i),o.setTimeout(e,100))}},a(r).on("cmb_init",s.initAll)}(window,document,jQuery,window.CMB2,window.CMB2.wysiwyg);
