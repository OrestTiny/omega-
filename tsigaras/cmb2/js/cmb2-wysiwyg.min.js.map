{"version":3,"sources":["cmb2/js/cmb2-wysiwyg.js"],"names":["window","CMB2","wysiwyg","document","toBeDestroyed","toBeInitialized","all","delayedInit","length","forEach","toInit","splice","indexOf","init","apply","setTimeout","delayedDestroy","id","destroy","data","$this","value","$","each","this","groupid","attr","name","val","initiated","QTags","_buttonsInit","on","addRow","destroyRowEditors","shiftStart","shiftComplete","evt","$row","initRow","$btn","$from","add","find","parents","$to","$toReplace","push","defVal","cmb","getFieldArg","hash","iterator","fieldid","type","mceActive","buttonsInit","canTinyMCE","qtActive","quicktags","extend","template","wp","defaults","mce","tinyMCEPreInit","mceInit","qt","qtInit","getGroupData","newSettings","prop","newQTS","nameRegex","RegExp","options","idRegex","replace","initOptions","tinyMCE","editor","removeClass","addClass","get","initAll","jQuery"],"mappings":"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","file":"cmb2-wysiwyg.min.js","sourcesContent":["/**\n * Used for WYSIWYG logic\n */\nwindow.CMB2 = window.CMB2 || {};\nwindow.CMB2.wysiwyg = window.CMB2.wysiwyg || {};\n\n( function(window, document, $, cmb, wysiwyg, undefined ) {\n\t'use strict';\n\n\t// Private variables\n\tvar toBeDestroyed = [];\n\tvar toBeInitialized = [];\n\tvar all = wysiwyg.all = {};\n\n\t// Private functions\n\n\t/**\n\t * Initializes any editors that weren't initialized because they didn't exist yet.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @return {void}\n\t */\n\tfunction delayedInit() {\n\n\t\t// Don't initialize until they've all been destroyed.\n\t\tif ( 0 === toBeDestroyed.length ) {\n\t\t\ttoBeInitialized.forEach( function ( toInit ) {\n\t\t\t\ttoBeInitialized.splice( toBeInitialized.indexOf( toInit ), 1 );\n\t\t\t\twysiwyg.init.apply( wysiwyg, toInit );\n\t\t\t} );\n\t\t} else {\n\t\t\twindow.setTimeout( delayedInit, 100 );\n\t\t}\n\t}\n\n\t/**\n\t * Destroys any editors that weren't destroyed because they didn't exist yet.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @return {void}\n\t */\n\tfunction delayedDestroy() {\n\t\ttoBeDestroyed.forEach( function( id ) {\n\t\t\ttoBeDestroyed.splice( toBeDestroyed.indexOf( id ), 1 );\n\t\t\twysiwyg.destroy( id );\n\t\t} );\n\t}\n\n\t/**\n\t * Gets the option data for a group (and initializes that data if it doesn't exist).\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} data The group/field data.\n\t *\n\t * @return {object}      Options data object for a group.\n\t */\n\tfunction getGroupData( data ) {\n\t\tvar groupid = data.groupid;\n\t\tvar fieldid = data.fieldid;\n\n\t\tif ( ! all[ groupid ] || ! all[ groupid ][ fieldid ] ) {\n\t\t\tall[ groupid ] = all[ groupid ] || {};\n\t\t\tall[ groupid ][ fieldid ] = {\n\t\t\t\ttemplate : wp.template( 'cmb2-wysiwyg-' + groupid + '-' + fieldid ),\n\t\t\t\tdefaults : {\n\n\t\t\t\t\t// Get the data from the template-wysiwyg initiation.\n\t\t\t\t\tmce : $.extend( {}, tinyMCEPreInit.mceInit[ 'cmb2_i_' + groupid + fieldid ] ),\n\t\t\t\t\tqt  : $.extend( {}, tinyMCEPreInit.qtInit[ 'cmb2_i_' + groupid + fieldid ] )\n\t\t\t\t}\n\t\t\t};\n\t\t\t// This is the template-wysiwyg data, and we do not want that to be initiated.\n\t\t\tdelete tinyMCEPreInit.mceInit[ 'cmb2_i_' + groupid + fieldid ];\n\t\t\tdelete tinyMCEPreInit.qtInit[ 'cmb2_i_' + groupid + fieldid ];\n\t\t}\n\n\t\treturn all[ groupid ][ fieldid ];\n\t}\n\n\t/**\n\t * Initiates the tinyMCEPreInit options for a wysiwyg editor instance.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} options Options data object for the wysiwyg editor instance.\n\t *\n\t * @return {void}\n\t */\n\tfunction initOptions( options ) {\n\t\tvar nameRegex = new RegExp( 'cmb2_n_' + options.groupid + options.fieldid, 'g' );\n\t\tvar idRegex   = new RegExp( 'cmb2_i_' + options.groupid + options.fieldid, 'g' );\n\t\tvar prop, newSettings, newQTS;\n\n\t\t// If no settings for this field. Clone from placeholder.\n\t\tif ( 'undefined' === typeof( tinyMCEPreInit.mceInit[ options.id ] ) ) {\n\t\t\tnewSettings = $.extend( {}, options.defaults.mce );\n\t\t\tfor ( prop in newSettings ) {\n\t\t\t\tif ( 'string' === typeof( newSettings[ prop ] ) ) {\n\t\t\t\t\tnewSettings[ prop ] = newSettings[ prop ]\n\t\t\t\t\t\t.replace( idRegex, options.id )\n\t\t\t\t\t\t.replace( nameRegex, options.name );\n\t\t\t\t}\n\t\t\t}\n\t\t\ttinyMCEPreInit.mceInit[ options.id ] = newSettings;\n\t\t}\n\n\t\t// If no Quicktag settings for this field. Clone from placeholder.\n\t\tif ( 'undefined' === typeof( tinyMCEPreInit.qtInit[ options.id ] ) ) {\n\t\t\tnewQTS = $.extend( {}, options.defaults.qt );\n\t\t\tfor ( prop in newQTS ) {\n\t\t\t\tif ( 'string' === typeof( newQTS[ prop ] ) ) {\n\t\t\t\t\tnewQTS[ prop ] = newQTS[ prop ]\n\t\t\t\t\t\t.replace( idRegex, options.id )\n\t\t\t\t\t\t.replace( nameRegex, options.name );\n\t\t\t\t}\n\t\t\t}\n\t\t\ttinyMCEPreInit.qtInit[ options.id ] = newQTS;\n\t\t}\n\t}\n\n\t/**\n\t * Initializes all group wysiwyg editors. Hooked to cmb_init.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.initAll = function() {\n\t\tvar $this,data,initiated;\n\n\t\t$( '.cmb2-wysiwyg-placeholder' ).each( function() {\n\t\t\t$this = $( this );\n\t\t\tdata  = $this.data();\n\n\t\t\tif ( data.groupid ) {\n\n\t\t\t\tdata.id    = $this.attr( 'id' );\n\t\t\t\tdata.name  = $this.attr( 'name' );\n\t\t\t\tdata.value = $this.val();\n\n\t\t\t\twysiwyg.init( $this, data, false );\n\t\t\t\tinitiated = true;\n\t\t\t}\n\t\t} );\n\n\t\tif ( true === initiated ) {\n\t\t\tif ( 'undefined' !== typeof window.QTags ) {\n\t\t\t\twindow.QTags._buttonsInit();\n\t\t\t}\n\n\t\t\t// Hook in our event callbacks.\n\t\t\t$( document )\n\t\t\t\t.on( 'cmb2_add_row', wysiwyg.addRow )\n\t\t\t\t.on( 'cmb2_remove_group_row_start', wysiwyg.destroyRowEditors )\n\t\t\t\t.on( 'cmb2_shift_rows_start', wysiwyg.shiftStart )\n\t\t\t\t.on( 'cmb2_shift_rows_complete', wysiwyg.shiftComplete );\n\t\t}\n\t};\n\n\t/**\n\t * Initiates wysiwyg editors in a new group row. Hooked to cmb2_add_row.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} evt A jQuery-normalized event object.\n\t * @param  {object} $row A jQuery dom element object for the group row.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.addRow = function( evt, $row ) {\n\t\twysiwyg.initRow( $row, evt );\n\t};\n\n\t/**\n\t * Destroys wysiwyg editors in a group row when that row is removed. Hooked to cmb2_remove_group_row_start.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} evt A jQuery-normalized event object.\n\t * @param  {object} $btn A jQuery dom element object for the remove-row button.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.destroyRowEditors = function( evt, $btn ) {\n\t\twysiwyg.destroy( $btn.parents( '.cmb-repeatable-grouping' ).find( '.wp-editor-area' ).attr( 'id' ) );\n\t};\n\n\t/**\n\t * When a row-shift starts, we need to destroy the wysiwyg editors for the group-rows being shuffled.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} evt   A jQuery-normalized event object.\n\t * @param  {object} $btn  A jQuery dom element object for the remove-row button.\n\t * @param  {object} $from A jQuery dom element object for the row being shifted from.\n\t * @param  {object} $to   A jQuery dom element object for the row being shifted to.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.shiftStart = function( evt, $btn, $from, $to ) {\n\t\t$from.add( $to ).find( '.wp-editor-wrap textarea' ).each( function() {\n\t\t\twysiwyg.destroy( $( this ).attr( 'id' ) );\n\t\t} );\n\t};\n\n\t/**\n\t * When a row-shift completes, we need to re-init the wysiwyg editors for the group-rows being shuffled.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} evt   A jQuery-normalized event object.\n\t * @param  {object} $btn  A jQuery dom element object for the remove-row button.\n\t * @param  {object} $from A jQuery dom element object for the row being shifted from.\n\t * @param  {object} $to   A jQuery dom element object for the row being shifted to.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.shiftComplete = function( evt, $btn, $from, $to ) {\n\t\t$from.add( $to ).each( function() {\n\t\t\twysiwyg.initRow( $( this ), evt );\n\t\t} );\n\t};\n\n\t/**\n\t * Initializes editors for a new CMB row.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} $row A jQuery dom element object for the group row.\n\t * @param  {object} evt  A jQuery-normalized event object.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.initRow = function( $row, evt ) {\n\t\tvar $toReplace, data, defVal;\n\n\t\t$row.find( '.cmb2-wysiwyg-inner-wrap' ).each( function() {\n\t\t\t$toReplace    = $( this );\n\t\t\tdata          = $toReplace.data();\n\t\t\tdefVal        = cmb.getFieldArg( data.hash, 'default', '' );\n\t\t\tdefVal        = 'undefined' !== typeof defVal && false !== defVal ? defVal : '';\n\n\t\t\tdata.iterator = $row.data( 'iterator' );\n\t\t\tdata.fieldid  = data.id;\n\t\t\tdata.id       = data.groupid + '_' + data.iterator + '_' + data.fieldid;\n\t\t\tdata.name     = data.groupid + '[' + data.iterator + '][' + data.fieldid + ']';\n\t\t\tdata.value    = 'cmb2_add_row' !== evt.type && $toReplace.find( '.wp-editor-area' ).length ? $toReplace.find( '.wp-editor-area' ).val() : defVal;\n\n\t\t\t// The destroys might not have happened yet.  Don't init until they have.\n\t\t\tif ( 0 === toBeDestroyed.length ) {\n\n\t\t\t\twysiwyg.init( $toReplace, data );\n\n\t\t\t} else {\n\t\t\t\ttoBeInitialized.push( [$toReplace, data] );\n\t\t\t\twindow.setTimeout( delayedInit, 100 );\n\t\t\t}\n\t\t} );\n\n\t};\n\n\t/**\n\t * Initiates a wysiwyg editor instance and replaces the passed dom element w/ the editor html.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {object} $toReplace A jQuery dom element which will be replaced with the wysiwyg editor.\n\t * @param  {object} data        Data used to initate the editor.\n\t * @param  {bool}   buttonsInit Whether to run QTags._buttonsInit()\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.init = function( $toReplace, data, buttonsInit ) {\n\t\tif ( ! data.groupid ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar mceActive = cmb.canTinyMCE();\n\t\tvar qtActive = 'function' === typeof window.quicktags;\n\t\t$.extend( data, getGroupData( data ) );\n\n\t\tinitOptions( data );\n\n\t\t$toReplace.replaceWith( data.template( data ) );\n\n\t\tif ( mceActive ) {\n\t\t\twindow.tinyMCE.init( tinyMCEPreInit.mceInit[ data.id ] );\n\t\t}\n\n\t\tif ( qtActive ) {\n\t\t\twindow.quicktags( tinyMCEPreInit.qtInit[ data.id ] );\n\t\t}\n\n\t\tif ( mceActive ) {\n\t\t\t$( document.getElementById( data.id ) ).parents( '.wp-editor-wrap' ).removeClass( 'html-active' ).addClass( 'tmce-active' );\n\t\t}\n\n\t\tif ( false !== buttonsInit && 'undefined' !== typeof window.QTags ) {\n\t\t\twindow.QTags._buttonsInit();\n\t\t}\n\n\t};\n\n\t/**\n\t * Destroys a wysiwyg editor instance.\n\t *\n\t * @since  2.2.3\n\t *\n\t * @param  {string} id Editor id.\n\t *\n\t * @return {void}\n\t */\n\twysiwyg.destroy = function( id ) {\n\t\tif ( ! cmb.canTinyMCE() ) {\n\t\t\t// Nothing to see here.\n\t\t\treturn;\n\t\t}\n\n\t\t// The editor might not be initialized yet.  But we need to destroy it once it is.\n\t\tvar editor = tinyMCE.get( id );\n\n\t\tif ( editor !== null && typeof( editor ) !== 'undefined' ) {\n\t\t\teditor.destroy();\n\n\t\t\tif ( 'undefined' === typeof( tinyMCEPreInit.mceInit[ id ] ) ) {\n\t\t\t\tdelete tinyMCEPreInit.mceInit[ id ];\n\t\t\t}\n\n\t\t\tif ( 'undefined' === typeof( tinyMCEPreInit.qtInit[ id ] ) ) {\n\t\t\t\tdelete tinyMCEPreInit.qtInit[ id ];\n\t\t\t}\n\n\t\t} else if ( -1 === toBeDestroyed.indexOf( id ) ) {\n\t\t\ttoBeDestroyed.push( id );\n\t\t\twindow.setTimeout( delayedDestroy, 100 );\n\t\t}\n\t};\n\n\t// Hook in our event callbacks.\n\t$( document ).on( 'cmb_init', wysiwyg.initAll );\n\n} )( window, document, jQuery, window.CMB2, window.CMB2.wysiwyg );\n"]}